{% extends "base.html" %}

{% load i18n %}

{% block content %}

<form method="post" enctype="multipart/form-data">{% csrf_token %}
    {% for field in form %}
        <div class="{{ field.field.css_class }}">
            {% if field.name == 'services' %}
                {{ field.label_tag }}
                <div class="accordion">
                    {% with field|dictsort:"attrs.cat_name" as options %}
                        {% regroup options by attrs.cat_name as groups %}
                        {% for group in groups %}
                            <h3 class="service-group">{{ group.grouper }}</h3>
                            <div>
                                <ul class="services">
                                    {% for option in group.list %}
                                        <li class="service col-lg-4">{{ option }}</li>
                                    {% endfor %}
                                </ul>
                            </div>
                        {% endfor %}
                    {% endwith %}
                </div>
            {% else %}
                {{ field.label_tag }} {{ field }}
            {% endif %}
        </div>
    {% endfor %}
    {{ telephone_formset.management_form }}
    {% for telephone_form in telephone_formset %}
        {% for telephone_field in telephone_form %}
                <div class="{{ telephone_field.field.css_class }}">
                    {% if not telephone_field.is_hidden %}
                        {{telephone_field.label_tag}}
                    {% endif %}
                    {{ telephone_field }}
                </div>
        {% endfor %}
    {% endfor %}
    {{ image_formset.management_form }}
    {% for image_form in image_formset %}
        {% for image_field in image_form %}
                <div class="{{ image_field.field.css_class }}">
                    {% if not image_field.is_hidden %}
                        {{image_field.label_tag}}
                    {% endif %}
                    {{ image_field }}
                </div>
        {% endfor %}
    {% endfor %}
    <input type="submit" value="Submit" />
</form>
{% endblock %}

{% block specific_js %}
    <script type="text/javascript">
        $(function(){
            target_elements = []
            $("div[class^='field-trans-']").each(function(){
                field_class = $(this).attr('class')
                trans = field_class.replace("field-trans-", "").split("_");
                field = trans[0];
                lang = trans[1];
                target_id = 'tabs-'+field;
                target_element = $("#"+target_id);
                if(target_element.length == 0){
                    target_element = $('<div class="tabs" id="'+target_id+'"/>');
                    ul = target_element.append('<ul/>');
                    //$("#content-body form").prepend(target_element);
                    $(".container form").prepend(target_element);
                }
                field_id = field+'-'+lang;
                $("ul", target_element).append('<li><a href="#'+field_id+'">'+lang+'</a></li>');
                target_element.append('<div id="'+field_id+'"></div>');
                $("#"+field_id, target_element).append($(this));
            });
            $(".tabs").tabs();
        });
    </script>
    <script type="text/javascript" src="{{ STATIC_URL }}js/accordion.js"></script>
{% endblock specific_js %}
