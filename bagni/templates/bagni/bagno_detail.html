{% extends "base.html" %}

{% load l10n i18n thumbnail %}
{% load batch from custom_filters %}

{% block content %}
    <div class="bagno-detail-wrapper-div">
        <div class="row">
            <div class="col-xs-12">
                {% if object.name %}
                    <h1 class="bagno-detail-header">{{ object.name|safe }}</h1>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <p class="bagno-detail-address">{{ object.address }} - {{ object.neighbourhood.name }}</p>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-5">
                {% if object.images.all %}
                    <div id="bagno-image-carousel" class="carousel slide" data-ride="carousel" data-interval="false">
                        <!-- Indicators -->
                        <ol class="carousel-indicators">
                        {% with object.images.all as bagno_images %}
                            {% for bagno_image in bagno_images %}
                                {% if forloop.first %}
                                <li data-target="#bagno-image-carousel" data-slide-to="{{ forloop.counter }}" class="active"></li>
                                {% else %}
                                <li data-target="#bagno-image-carousel" data-slide-to="{{ forloop.counter }}" ></li>
                                {% endif %}
                            {% endfor %}
                        {% endwith %}
                        </ol>
                        <!-- Wrapper for slides -->
                        <div class="carousel-inner">
                        {% with object.images.all as bagno_images %}
                            {% for bagno_image in bagno_images %}
                                {% if forloop.first %}
                                <div class="item active">
                                    <img src="{{ bagno_image.image.url }}" alt="{{ object.name|safe }} {% trans "image" %}">
                                </div>
                                {% else %}
                                <div class="item">
                                    <img src="{{ bagno_image.image.url }}" alt="{{ object.name|safe }} {% trans "image" %}">
                                </div>
                                {% endif %}
                            {% endfor %}
                            <!-- Controls -->
                            <a class="left carousel-control" href="#bagno-image-carousel" data-slide="prev">
                                <span class="glyphicon glyphicon-chevron-left"></span>
                            </a>
                            <a class="right carousel-control" href="#carousel-example-generic" data-slide="next">
                                <span class="glyphicon glyphicon-chevron-right"></span>
                            </a>
                        {% endwith %}
                        </div>
                    </div>
                {% else %}
                    <div class="no-images-wrapper-div">
                        <img class ="thumbnail img-responsive" src="{{ STATIC_URL }}img/no_images.png" alt="{% trans "No images available for" %} {{ object.name|safe }}">
                        <span class="no-images-text"><a href="#">{% trans "No photos available. Add one now" %}.</a></span>
                    </div>
                {% endif %}
            </div>
            <div class="col-xs-5 col-xs-offset-2">
                <div id="bagno_map" class="well" style="width: 100%; height: 350px"></div>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <h2 class="bagno-detail-sub-header">{% trans "Contacts" %}</h2>
                {% if object.telephones.all %}
                    <p><span class="bagno-detail-label">{% trans "Telephone numbers" %}: </span>
                    {% for tel in object.telephones.all %}
                    {{ tel.name }} {{ tel.number }}
                    {% if forloop.last %}
                    {% else %}
                     -
                    {% endif %}
                    {% endfor %}</p>
                {% else %}
                    <p><span class="my-bold">{% trans "Telephone numbers" %}: </span><em>{% trans "not yet available" %}</em></p>
                {% endif %}
                {% if object.site %}
                    <p><span class="my-bold">{% trans "Website" %}: </span><a href="{{ object.site }}">{{ object.site }}</a></p>
                {% else %}
                    <p><span class="my-bold">{% trans "Website" %}: </span><em>{% trans "not yet available" %}</em></p>
                {% endif %}
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12">
                <h2 class="bagno-detail-sub-header">{% trans "Facilities" %}</h2>
                {% if object.services.all %}
		            {% with object.services.all|dictsort:"category" as services %}
		                {% regroup services by category as categorized_services %}
		                {% for categorized_service in categorized_services %}
		                    <div class="row">
		                        <div class="col-xs-12"><h4 class="">{% filter capfirst %}{% trans categorized_service.grouper.name %}{% endfilter %}</h4></div>
		                    </div>
		                    {% for service_batch in categorized_service.list|batch:4 %}
		                    <div class="row">
		                        {% for service in service_batch %}
		                        <div class="col-xs-3">
		                            <p><span class="glyphicon glyphicon-ok service-glyphicon"></span>  {% trans service.name %}</p>
		                        </div>
		                        {% endfor %}
		                    </div>
		                    {% endfor %}
		                {% endfor %}
		            {% endwith %}
		        {% else %}
		            <p><em>{% trans "Facilities information not available" %}</em></p>
		        {% endif %}
            </div>
        </div>
    </div>
{% endblock content %}

{% block specific_js %}
    {% if object.point.x and object.point.y %}
        <script type="text/javascript">
        var map
        $(function() {
            map = L.map('bagno_map').setView([{{ object.point.y|unlocalize }}, {{ object.point.x|unlocalize }}], 13);
            L.tileLayer('http://{s}.mqcdn.com/tiles/1.0.0/osm/{z}/{x}/{y}.png', {
                attribution: 'Data, imagery and map information provided by <a href="http://open.mapquest.co.uk" target="_blank">MapQuest</a>, <a href="http://www.openstreetmap.org/" target="_blank">OpenStreetMap</a> and contributors.',
                subdomains: ['otile1','otile2','otile3','otile4'],
                maxZoom: 18
            }).addTo(map);
            var marker = L.marker([{{ object.point.y|unlocalize }}, {{ object.point.x|unlocalize }}]).addTo(map);
            marker.bindPopup('<span class="my-bold">{{ object.name }}</span><br><em>{{ object.address }}</em>').openPopup();
        });
        </script>
    {% endif %}
{% endblock specific_js %}

{% block pagetitle %}
    {% if object.number %}
        {{ object.number }} -
    {% endif %}
    {{ object.name }}
{% endblock pagetitle %}


