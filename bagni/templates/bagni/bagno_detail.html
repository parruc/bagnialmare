{% extends "base.html" %}

{% load l10n i18n thumbnail %}

{% block main_content %}

    {% with object.image_set.all|first as bagno_image %}
        {% thumbnail bagno_image.image "200x200" crop="center" as thumb %}
            <img class="bagno-image"
                width="{{thumb.width}}"
                height="{{thumb.height}}"
                src="{{ thumb.url }}"
                alt="{{ bagno_image.image.title }}" />
        {% endthumbnail %}
    {% endwith %}


    {% if object.services.all %}
        {% regroup object.services.all by get_category_display as categorized_services %}
        <h2>{% trans Services %}</h2>
        <ul>
        {% for categorized_service in categorized_services %}
            <li>{{ categorized_service.grouper }}
            <ul>
                {% for service in categorized_service.list %}
                  <li>{{ service.name }}</li>
                {% endfor %}
            </ul>
            </li>
        {% endfor %}
        </ul>
    {% endif %}

    <h2>{% trans Contacts %}</h2>
    <p>{{ object.address }} - {{ object.city }}</p>
    <p>{{ object.mail }}</p>
    <p>{{ object.tel }}</p>
    <p>{{ object.fax }}</p>
    <p>{{ object.site }}</p>
    <div id="bagno_map" style="width: 600px; height: 400px"></div>
{% endblock main_content %}

{% block specific_js %}
    <script type="text/javascript">
    var map
    $(function() {
        map = L.map('bagno_map').setView([{{ object.point.y|unlocalize }}, {{ object.point.x|unlocalize }}], 13);
        L.tileLayer('http://{s}.tile.cloudmade.com/8def8118b32e4f8eaba97e1e68ebd068/997/256/{z}/{x}/{y}.png', {
        maxZoom: 18,
        attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, <a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="http://cloudmade.com">CloudMade</a>'
        }).addTo(map);
        var marker = L.marker([{{ object.point.y|unlocalize }}, {{ object.point.x|unlocalize }}]).addTo(map);
        marker.bindPopup("<strong>{{ object.name }}</strong><em>{{ object.address }}</em><br>").openPopup();
    });
    </script>
{% endblock specific_js %}

{% block pagetitle %}
    {% if object.number %}
        {{ object.number }} -
    {% endif %}
    {{ object.name }}
{% endblock pagetitle %}

{% block title %}
    {% if object.number %}
        {{ object.number }} -
    {% endif %}
    {{ object.name }}
{% endblock title %}
